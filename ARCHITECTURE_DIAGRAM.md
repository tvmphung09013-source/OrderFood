# Chat Feature Architecture Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER INTERFACE LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ProductListActivityâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  ChatActivity    â”‚              â”‚
â”‚  â”‚                    â”‚ Intent  â”‚                  â”‚              â”‚
â”‚  â”‚  [Products]  [ğŸ’¬]  â”‚         â”‚  [Messages]      â”‚              â”‚
â”‚  â”‚              [ğŸ›’]  â”‚         â”‚  [Input] [Send]  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                          â”‚                         â”‚
â”‚                                          â”‚                         â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                  â”‚  ChatAdapter    â”‚              â”‚
â”‚                                  â”‚  RecyclerView   â”‚              â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                          â”‚                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                         â”‚                                 â”‚       â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚
â”‚              â”‚ Customer Message  â”‚            â”‚ Store Message   â”‚ â”‚
â”‚              â”‚ (Right, Green)    â”‚            â”‚ (Left, Gray)    â”‚ â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Uses
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MODEL LAYER                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                      â”‚ ChatMessage   â”‚                             â”‚
â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚                      â”‚ - id          â”‚                             â”‚
â”‚                      â”‚ - message     â”‚                             â”‚
â”‚                      â”‚ - timestamp   â”‚                             â”‚
â”‚                      â”‚ - isFromCustomer                            â”‚
â”‚                      â”‚ - senderName  â”‚                             â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Accessed via
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA ACCESS LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                      â”‚   ChatDao     â”‚                             â”‚
â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚                      â”‚ + insert()    â”‚                             â”‚
â”‚                      â”‚ + getAllMessages()                          â”‚
â”‚                      â”‚ + deleteAllMessages()                       â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Operates on
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE LAYER                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                   â”‚  AppDatabase     â”‚                             â”‚
â”‚                   â”‚   (Room v4)      â”‚                             â”‚
â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚                   â”‚ Users            â”‚                             â”‚
â”‚                   â”‚ Products         â”‚                             â”‚
â”‚                   â”‚ CartItems        â”‚                             â”‚
â”‚                   â”‚ ChatMessages  â—€â”€â”€â”¼â”€â”€ New!                      â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### Sending a Message

```
User Types Message
       â”‚
       â–¼
[ChatActivity]
       â”‚
       â–¼
Create ChatMessage Object
   (timestamp, text, isFromCustomer=true)
       â”‚
       â–¼
[ExecutorService] â”€â”€â”€â”€â”€â”€â”€â”€â–¶ [ChatDao.insert()]
   (Background Thread)            â”‚
       â”‚                          â–¼
       â”‚                    [Room Database]
       â”‚                     Save Message
       â”‚                          â”‚
       â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
[Handler.post()] â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Update UI (Main Thread)
       â”‚
       â–¼
ChatAdapter.notifyDataSetChanged()
       â”‚
       â–¼
RecyclerView Updates
       â”‚
       â–¼
Scroll to Bottom
       â”‚
       â–¼
Simulate Store Response (2s delay)
```

### Loading Messages

```
[ChatActivity.onCreate()]
       â”‚
       â–¼
[ExecutorService] â”€â”€â”€â”€â”€â”€â”€â”€â–¶ [ChatDao.getAllMessages()]
   (Background Thread)            â”‚
       â”‚                          â–¼
       â”‚                    [Room Database]
       â”‚                     Query Messages
       â”‚                          â”‚
       â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
[Handler.post()] â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Update UI (Main Thread)
       â”‚
       â–¼
ChatAdapter.updateMessages()
       â”‚
       â–¼
RecyclerView Displays All Messages
```

## Component Relationships

```
ProductListActivity
      â”‚
      â”‚ User taps chat icon
      â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                                     â”‚
      â–¼                                     â”‚
Intent to ChatActivity                     â”‚
      â”‚                                     â”‚
      â–¼                                     â”‚
ChatActivity                                â”‚
      â”‚                                     â”‚
      â”œâ”€â”€ ChatAdapter â—€â”€â”€ List<ChatMessage> â”‚
      â”‚       â”‚                             â”‚
      â”‚       â””â”€â”€ chat_message_item.xml     â”‚
      â”‚                                     â”‚
      â”œâ”€â”€ EditText (messageInput)           â”‚
      â”œâ”€â”€ ImageButton (sendButton)          â”‚
      â”œâ”€â”€ ImageButton (backButton) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                  
      â””â”€â”€ RecyclerView (chatRecyclerView)
              â”‚
              â””â”€â”€ LinearLayoutManager
```

## Thread Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Main Thread    â”‚         â”‚ Background Threadâ”‚
â”‚  (UI Updates)   â”‚         â”‚ (DB Operations)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â”‚  User Action              â”‚
         â”‚  (Send Button)            â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
         â”‚                           â”‚
         â”‚                    Execute DB Insert
         â”‚                    (ChatDao.insert)
         â”‚                           â”‚
         â”‚  Update Complete          â”‚
         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚  (via Handler)            â”‚
         â”‚                           â”‚
    Update UI                        â”‚
    (ChatAdapter)                    â”‚
         â”‚                           â”‚
```

## Message Layout Structure

```
chat_message_item.xml
â”‚
â”œâ”€â”€ LinearLayout (Root)
    â”‚
    â”œâ”€â”€ LinearLayout (customerMessageLayout) [Right Aligned]
    â”‚   â”‚
    â”‚   â””â”€â”€ LinearLayout (Message Bubble - Green)
    â”‚       â”œâ”€â”€ TextView (customerMessageText)
    â”‚       â””â”€â”€ TextView (customerTimeText)
    â”‚
    â””â”€â”€ LinearLayout (storeMessageLayout) [Left Aligned]
        â”‚
        â””â”€â”€ LinearLayout (Message Bubble - Gray)
            â”œâ”€â”€ TextView (storeSenderName)
            â”œâ”€â”€ TextView (storeMessageText)
            â””â”€â”€ TextView (storeTimeText)
```

## Navigation Flow

```
App Launch
    â”‚
    â–¼
LoginActivity
    â”‚
    â”‚ Login Success
    â–¼
ProductListActivity
    â”‚
    â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     â”‚         â”‚         â”‚
    â”‚     â”‚         â”‚         â”‚
    â–¼     â–¼         â–¼         â–¼
Search  Product  Cart     Chat  â† NEW!
View    Detail   View     View
```

## Database Schema Evolution

```
Version 1-3:                  Version 4 (Current):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Users   â”‚                  â”‚ Users   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Products â”‚                  â”‚Products â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚CartItemsâ”‚                  â”‚CartItemsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                             â”‚ChatMsgs â”‚ â† NEW!
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
